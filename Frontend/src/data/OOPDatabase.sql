CREATE SCHEMA IF NOT EXISTS OOP;
USE OOP;

DROP TABLE IF EXISTS TRADES;
DROP TABLE IF EXISTS PORTFOLIOS;
DROP TABLE IF EXISTS STOCKS;
DROP TABLE IF EXISTS USERS;

CREATE TABLE IF NOT EXISTS USERS (
 UserID INT NOT NULL PRIMARY KEY,
 Email VARCHAR(64) NOT NULL,
 -- HashedPassword length depends on algorithm used,
 -- CHAR(60) data type assumes use of Bcrypt
 HashedPassword CHAR(60) NOT NULL
);

CREATE TABLE IF NOT EXISTS STOCKS (
 StockSymbol VARCHAR(20) NOT NULL PRIMARY KEY,
 StockName VARCHAR(64) NOT NULL,
 LastUpdatedDateTime DATETIME NOT NULL,
 LastUpdatedPrice DOUBLE NOT NULL,
 Sector VARCHAR(64) NOT NULL,
 Market VARCHAR(64) NOT NULL
);

CREATE TABLE IF NOT EXISTS PORTFOLIOS (
 PortfolioID INT NOT NULL PRIMARY KEY,
 PortfolioName VARCHAR(64) NOT NULL,
 Description VARCHAR(255) NOT NULL,
 Capital DOUBLE NOT NULL,
 UserID INT NOT NULL,
 CONSTRAINT PORTFOLIOS_fk1 FOREIGN KEY(UserID) references USERS(UserID)
);

CREATE TABLE IF NOT EXISTS TRADES (
 PurchaseDateTime DATETIME NOT NULL,
 PuchasePrice DOUBLE NOT NULL,
 PuchaseQuantity INT NOT NULL,
 PortfolioID INT NOT NULL,
 StockSymbol VARCHAR(20) NOT NULL,
 CONSTRAINT TRADES_pk PRIMARY KEY(PurchaseDateTime, PortfolioID, StockSymbol),
 CONSTRAINT TRADES_fk1 FOREIGN KEY(PortfolioID) references PORTFOLIOS(PortfolioID),
 CONSTRAINT TRADES_fk2 FOREIGN KEY(StockSymbol) references STOCKS(StockSymbol)
);